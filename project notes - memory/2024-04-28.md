- [ ] examine instantiations of caches inside mem module
- [[write operation procedure]]
- [ ] complete write operation
- [ ] implement different way of determining where write operation goes
- [ ] implement write back operation
- [[(decision)]] when [[write back]] on eviction, write back to upper level of cache
- [ ] lookup how [[write back]] policy works on multi-level caches
- [[thinking]] how [[write back]] will work
	- avoid duplication
		- When you write a piece of data to a cache, you always [[hit check]] before that, because if it already exists in that cache you simply write on top of it, if not, write it wherever you want
		- The check is to make sure we don't have 2 copies of the same piece of data in one cache, that is not only a waste but one of those will be old while the other is new which is a disaster!
	- Always write to the lowest cache, no need to check higher caches
		- the reason we [[hit check]] is simply to avoid duplication
		- so when we miss, this simply tells us that we can write wherever we want in that cache
		- whether upper caches have that piece of data does not concern us at the moment
	- Upper copies of the data may get evicted
	- remember the reason we write to the cache is so we can read it later
	- On [[eviction]], [[write back]] to **one upper cache level**
		- not all upper levels
		- to reduce memory accesses as much as possible
	- On write back, do a [[hit check]]
		- again to avoid duplication
		- basically on any write operation to a cache you do a hit check
	- [[eviction]] may happen when a cache misses in a [[read operation]]
		- it misses, requests the missing data from upper cache, data comes in, but cache is full, need to evict some piece of data
		- now that piece needs to be written back to upper cache
		- so write backs can happen even in a [[read operation]]
	- a [[write back]] itself may cause an [[eviction]], which in turn will trigger yet another write back, and so on
		- so there could be a chain of write-backs all the way back to [[virtual memory]]
	- upper caches literally only get written on [[write back]]s!
	- reads and writes by default only go to the lowest cache level
	- remember that on [[write operation]] [[eviction]], the dirty bit needs to be transferred to the upper cache along with the data
	- on [[read miss]], lookup in upper caches until hit, then simply bring that data to the lowest cache, no need to write it to any other cache in between
		- if the lowest cache has a conflict, then evict a piece of data to one upper cache
	- [[(problem)]] cascading [[eviction]]s / chain evictions / eviction avalanche
		- imagine an eviction happens in the lowest cache, which in turn causes an eviction in the upper one, which causes another one all the way to the virtual memory
		- what you will see is a wave going up towards virtual memory, then a wave going back down to lowest cache
		- this will take an ungodly long amount of time
		- is this extremely rare? or will it be increasingly common as the memory fills up?
- [[design principle]] reduce the number of memory accesses as much as possible, only do it when absolutely necessary
- [ ] on [[write operation]], that tag needs to also be written
- [x] research cache inclusion policy